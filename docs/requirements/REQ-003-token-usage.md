# REQ-003: Token 用量可视化

> 状态: 已确认 | 创建: 2026-02-08 | PM: Qiqi

## 1. 需求描述

### 背景
用户使用 AI 对话时不知道每次对话消耗了多少 token 和费用。需要提供可视化的 token 用量统计。

### 用户故事
- 作为用户，我想知道每条消息消耗了多少 token
- 作为用户，我想看到当前会话的累计用量
- 作为用户，我想了解大概的费用估算

## 2. 功能设计

### 消息级别
- 每条 AI 回复下方显示：`⚡ 1,234 tokens`
- 悬停显示详情：输入 token / 输出 token / 估算费用

### 会话级别
- 聊天顶栏显示当前会话累计：`📊 12.5k tokens`
- 点击展开详情面板

### Settings 统计
- Settings → General 添加总用量统计
- 按天/周/月的用量趋势（可选，后续迭代）

## 3. 技术设计

### 已有基础
- AI SDK 返回的 usage 已经在 tool-loop.ts 中被记录
- 消息对象中可能已有 usage 字段

### 需要做的
1. 确认 usage 数据是否已保存到消息中
2. 前端显示 token 数（消息级别）
3. 会话累计统计
4. 费用估算（基于模型价格）

### 影响模块
| 模块 | 改动 |
|------|------|
| MessageBubble.vue | 显示单条消息 token |
| ChatHeader.vue | 显示会话累计 |
| 新建 token-pricing.ts | 模型价格配置 |

## 4. 验收标准
- [ ] AI 回复显示 token 消耗
- [ ] 会话顶栏显示累计 token
- [ ] 悬停显示输入/输出/费用明细

## 5. 预估
~2 小时

---
*PM: Qiqi | 日期: 2026-02-08*
